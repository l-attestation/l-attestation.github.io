---
title: "La France des polices municipales"
description: "Cartographier les initiatives sécuritaires locales"
date: 2023-06-25
categories: [La police des sorties]
citation: 
  url: https://l-attestation.github.io/exercices/polices-municipales/ 
image: https://upload.wikimedia.org/wikipedia/commons/b/b4/Tolima_-_Champ_de_sorgho.JPG
draft: false
---

## Charger les principaux packages

```{r packages}
library(here)
library(tidyverse)
library(huxtable)
```

## Récupérer les données

Les effectifs des polices municipales par communes pour les années 2012 à 2021 ont été publiées par le Ministère de l'Intérieur sur le site [data.gouv.fr](https://www.data.gouv.fr/fr/datasets/police-municipale-effectifs-par-commune/).

Le code suivant télécharge le fichier de données dans un sous-dossier data (à ne faire qu'une fois, évidemment).

```{r path}
polices_municipales_path = here("data", "polices_municipales.ods")
```

```{r download}
download.file(url = "https://www.data.gouv.fr/fr/datasets/r/ad814337-074c-459b-add1-d78df9e6d85f",
              destfile = polices_municipales_path)
```


## Les lire

```{r read}
polices_municipales = readODS::read_ods(polices_municipales_path, skip = 8, col_names = FALSE, .name_repair = janitor::make_clean_names) |> 
  select(x, x_2, x_4:x_10) |> 
    rename(code_departement = x,
           nom_departement = x_2,
           nom_commune = x_4,
           population = x_5,
           municipaux = x_6,
           asvp = x_7,
           gardes_champetres = x_8,
           maitres_chiens = x_9,
           chiens_patrouille = x_10) |> 
  fill(nom_departement, .direction = "down") |> 
  filter(!is.na(code_departement))
```

::: {.callout-caution}
On croirait que le concepteur de ces données a pris un malin plaisir à les rendre inexploitables. Il n'y a pas de code postal pour les communes. Et aucune cohérence dans la manière d'écrire leurs noms. 
:::

```{r check}
polices_municipales |> 
  head(n = 20) |> 
  as_hux() |> 
  set_number_format(NA) |> 
  theme_mondrian()
```

## Les recoder

D'où un recodage particulièrement laborieux, pour parvenir à joindre ces données avec une base contenant la couche cartographique des communes.

