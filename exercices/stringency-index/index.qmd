---
title: "Les pays les plus sévères du monde"
description: "Que montre l'Oxford Covid 19 Government Response Tracker ?"
date: 2023-06-25
categories: [FAQ]
citation: 
  url: https://l-attestation.github.io/exercices/stringency-index/ 
image: https://upload.wikimedia.org/wikipedia/commons/b/b5/Home_quarantine_stamp_BMC.jpg
draft: false
---

# Charger les principaux packages

```{r packages}
library(here)
library(tidyverse)
library(lubridate)
library(countrycode)
```

# Récupérer les données

Note : jusqu'à juin 2023, les données étaient mises à disposition dans ce repo Github : [covid-policy-tracker](https://github.com/OxCGRT/covid-policy-tracker). Depuis juin 2023, un nouveau repo abrite la version définitive des données : [covid-policy-dataset](https://github.com/OxCGRT/covid-policy-dataset). Lors de la rédaction du livre, nous avons utilisé le premier. *A priori*, cela n'entraîne aucune modification importante.

```{r path}
oxcgrt_path = here("data", "oxcgrt.rds")
```

```{r new_repo}
#| eval: false
new_repo = "https://raw.githubusercontent.com/OxCGRT/covid-policy-dataset/main/data/OxCGRT_compact_national_v1.csv" # pour information
```

```{r download}
#| eval: false
old_repo = "https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_nat_latest.csv"
read_csv(old_repo,
         col_select = c(CountryName,
                        Date,
                        starts_with("C6"),
                        StringencyIndex_Average)) |>
  write_rds(oxcgrt_path)
```

```{r read}
oxcgrt = read_rds(oxcgrt_path) |> 
  janitor::clean_names() %>%
  mutate(date = ymd(date),
         national_or_subnational_saho = case_when(c6m_stay_at_home_requirements %in% 0:1 ~ 0,
                                                  c6m_stay_at_home_requirements == 2 ~ 1,
                                                  c6m_stay_at_home_requirements == 3 ~ 2),
         national_saho = national_or_subnational_saho *  c6m_flag) %>%
  select(country_name,
         date,
         stringency_index_average,
         national_or_subnational_saho,
         national_saho)
```

## Comprendre le codage des *Stay-at-home-orders*

Il s'agit de la variable *C6M_Stay at home requirements*, complétée par la variable *C6M_Flag*.

D'après le [dictionnaire des codes](https://github.com/OxCGRT/covid-policy-dataset/blob/main/documentation_and_codebook.md) :

*C6M_Stay at home requirements* prend les valeurs suivantes :

- 0 : no measures
- 1 : recommend not leaving house
- 2 : require not leaving house with exceptions for daily exercise, grocery shopping, and 'essential' trips
- 3 : require not leaving house with minimal exceptions (eg allowed to leave once a week, or only one person can leave at a time, etc)
- Blank : no data

C6M_Flag précise l'extension géographique de ces mesures :

- 0 : targeted
- 1 : general
- Blank : no data

## Choisir les bornes temporelles

```{r time_boundaries}
date_beginn = ymd(20200301)
date_end = ymd(20200601)
date_end - date_beginn
```

## Agréger

```{r summarise}
oxcgrt_spring_summary = oxcgrt |> 
  filter(between(date, date_beginn, date_end)) |> 
  group_by(country_name) |> 
  summarise(stringency_index_average = mean(stringency_index_average, na.rm = T),
            across(ends_with("saho"), ~ sum(.x, na.rm = T)))
```
